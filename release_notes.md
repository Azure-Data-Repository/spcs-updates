# Snowpark Container Services Limited PrPr Release Notes

This page contains release notes for past and upcoming behavior changes for the limited Private Preview of Snowpark Container Services (SPCS). 

SPCS is a new product offered by Snowflake, so it sees frequent updates and occasional behavior changes at this stage of the product development lifecycle. As such, this document is meant to keep early users informed of recent and upcoming user-visible changes. This page is considered the most up-to-date source of truth for user-facing changes; there is some delay in making changes to the [public documentation](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/overview).

**Note**: Run `SELECT CURRENT_VERSION()` to see the current version of Snowflake in your account.

_Last updated: Dec 5, 2023 / (v7.43.0)_
<br><br>

## Upcoming changes
| Feature | Description | Release | Reflected in official docs? |
| -------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------- |--------|
| Enable sharing of event tables with providers | In the context of SPCS services and jobs running within Native Apps in a consumer account, this enables the sharing of event tables from consumer to provider accounts. | Est. ~Dec | NA |
<br>

## Past changes
| Feature | Description | Release | Reflected in official docs? |
| ----------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------- | ---------------------------------------------------------------------------------------------------------------------- |
| User account information in context headers on ingress | On ingress, pass information about the username and email of the logged-in user upon ingress access on a service to Ingress Proxy. Information is as a special header to the service endpoint. Header format: ```Sf-Context-Current-User: <username> Sf-Context-Current-User-Email: <email>``` | 7.38.0 | In progress |
| GPU access requires explicit resource requests and limits | When creating a service or job which requires access to a GPU, the customer needs to explicit set `resources.requests.nvidia.com/gpu` and `resources.limits.nvidia.com/gpu` in their spec. Any container which does not explicitly request `nvidia.com/gpu` resources will not have access to a GPU. Note: this change results in the inability for multiple containers to share the same GPU. This is by design, since SPCS does not support GPU sharing. | 7.42 | In progress |
| Public endpoint creation privilege | Introduces a `GRANT BIND SERVICE ENDPOINT ON ACCOUNT` privilege. This privilege must be granted to a service owner role in order to publish a public endpoint from a SPCS service that allows user ingress. This is intended to prevent data exfiltration risk. When clients outside of snowflake access a service public endpoint, Snowflake will validate that the service owner role owns that privilege. Services may still be created with public endpoints by owners without that privilege, but ingress will be denied when users try to access those services. In the native app case, the consumer must grant the privilege to the app which wants to expose public endpoints with user ingress: ` GRANT BIND SERVICE ENDPOINT ON ACCOUNT TO APPLICATION {app}` | 7.43 | In progress |
| List images in repository | Introduces function to list all images in an image repsoitory. Syntax: `use role <role with repo access>; call system$registry_list_images('/db_name/schema_name/repo_name');` | 7.41 | In progress |
| Exclusive compute pools for native apps | Introduces the concept of "exclusive" compute pools and requires that compute pools running services in the context of a Native App are exclusive to that Native App. Exclusive compute pools can be created using the following syntax: `CREATE COMPUTE POOL <name>  FOR APPLICATION <app_name> ...`. If the compute pool is not exclusive to the application, an appropriate error message will be provided to the user. Note that when the application is dropped, even if the application name is the same, the compute pool will need to be recreated for the application. Also, note that providers can use a normal. non-exclusive compute pool to debug and test multiple applications in one pool within the same account. However, for cross-account tests or other use cases involving different accounts, an exclusive compute pool will need to be used.<br><br>The output for `SHOW/DESC COMPUTE POOL` will contain 2 new fields: (1) `is_exclusive`: boolean flag that displays if the compute pool is exclusive or not. `application` name of the application. If the application does not exist or the user does not have permission on the application, `Application does not exist or not authorized` will be displayed. | 7.42 | In progress |
| SHOW/DESC service fix | Removed a few obsolete columns and added missing columns to the output of `show services` and `desc service` | 7.40 | [here](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/reference/service#show-services) |
| Enrich the `CREATE COMPUTE POOL` return message | When a compute pool is created, there is currently a lag time of anywhere from ~10-20 min before a service can be created in it. This change enriches the return message to let customer know compute pool is not ready to deploy a service until reaching `ACTIVE` or `IDLE` state. The new return message is: `Compute Pool <NAME> successfully created. Please run 'DESCRIBE COMPUTE POOL <NAME>' to check the compute pool state. NOTE the compute pool is not ready to deploy a service or job before reaching ACTIVE or IDLE state.` | 7.40 | NA |
| Service autoscaling activated | Activates horizontal pod autoscaling (HPA) for services. | 7.41 | [here](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/working-with-services#creating-multiple-service-instances-and-autoscaling) |
| Require usage of OAuth token for authentication with Snowflake | Enables changes that will **require** that all connections from SPCS containers to the Snowflake warehouse use the OAuth login token injected into the container for authentication with Snowflake. Docs on using OAuth tokens for authenticating with Snowflake from containers can be found [here](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/additional-considerations-services-jobs#using-an-oauth-token-to-execute-sql). When you create a service/job, Snowflake runs the containers and provides an Oauth token for containers to use at the following location within the container: `/snowflake/session/token`. <br><br> This will be a breaking change for any container services that currently use an authentication method other than the Snowflake OAuth login token to connect to the warehouse, for example the Python connector, JDBC driver, or NodeJS driver. | 7.40 | [here](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/additional-considerations-services-jobs#using-an-oauth-token-to-execute-sql) |
| Add `SPECIFICATION_FILE` property alias | Adds an alias for `SPEC` property when creating/altering a service. E.g., `CREATE SERVICE foo IN COMPUTE POOL bar FROM @mystage SPECIFICATION_FILE=spec.yaml;` The shorter `SPEC` is still valid and will be kept. | 7.39 | [here](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/reference/service#create-service) |
| Adjust job return message | Current failure message: `Service <uuid> failed to complete. Exited with status: <status>.`<br>New failure message: `Job <uuid> failed to complete. Exited with status: <status>.`<br>Current success message: `Execution <uuid> completed successfully.`<br>New success message: `Job <uuid> completed successfully with status: <status>.` | 7.39 | [here](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/working-with-jobs#executing-jobs) |
| Support service `FUTURE` and `ALL` grants | Supports syntax for FUTURE and ALL grants on services. E.g., `grant/revoke <priv> on future services in schema <schema>` and `grant/revoke <priv> on all services in schema <schema>` See more about future grants [here](https://docs.snowflake.com/en/user-guide/security-access-control-configure#assigning-future-grants-on-objects) | 7.38 | [here](https://docs.snowflake.com/en/user-guide/security-access-control-configure#assigning-future-grants-on-objects) |
| Alter instance parameters for running services | Allows users to scale the number of instances for an existing service by altering the `MIN_INSTANCES` and `MAX_INSTANCES` count. The syntax for this feature is: <br><br>`ALTER SERVICE <name> SET MIN_INSTANCES = <num>;` | 7.38 | In progress |
| Disable egress by default in Native Apps | For *native apps* containing SPCS jobs/services, this release will restrict all internet egress by default. For Native App + SPCS PuPr, native apps will use [external access integrations](https://docs.snowflake.com/sql-reference/sql/create-external-access-integration). Until that is in product, there is an "all or nothing" parameter controlled by Snowflake, which is now set to false by default for all accounts. For partners building Native Apps that require egress, please work with your Snowflake contacts to have this parameter flipped off to prevent disruptions. | 7.38 | In progress|
| Alter existing service with a spec | Allow user to update an existing service with an updated service spec. <br>```ALTER SERVICE <SERVICE> [IF EXISTS]  [FROM @<STAGE>] [FROM SPECIFICATION '<inline_spec>'] [SPEC = '<spec_file_path>'];```<br> | 7.37 | In progress |
| Alter AUTO_RESUME parameter for services | Allows users to alter the AUTO_RESUME parameter for an existing service. The syntax for this feature is:<br><br>`ALTER SERVICE <name> SET AUTO_RESUME = FALSE;` | 7.37 | [Yes](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/reference/service#parameters) |
| Default compute pool auto suspend interval | Sets the default `AUTO_SUSPEND_SECS` parameter value for a compute pool to to 3600s (i.e., 1 hour). The current behavior does not set an auto-suspend parameter for a new compute pool. Moving forward, any compute pool that is unused will be automatically suspended after 1 hour unless there is an explicit value for `AUTO_SUSPEND_SECS`. | 7.37 | In progress |
| Change compute pool auto suspend duration | Enables changing of auto suspension setting for a compute pool via the `ALTER COMPUTE POOL SET AUTO_SUSPEND_SECS = <secs>` command. | 7.37 | [Yes](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/reference/compute-pool#id1) |
| Synchronous job runs | Enables running of jobs in a synchronous fashion. I.e., job execution (`EXECUTE SERVICE`) commands do not return until the job is complete. Returns with a message saying “Execution \<Query UUID\> completed successfully.”<br><br>Additionally enables the usage of the `system$cancel_query(<QUERY_UUID>)` syntax to cancel a job.<br><br>Before this change, jobs execute asynchronously and job execution commands return with “Execution submitted successfully as \<Query UUID\>.” | 7.37 | [Yes](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/working-with-jobs) |
| User Logs Default Level | User logs default level will be changed from \`INFO\` to \`NONE\`. Meaning that by default user logs ingestion to event tables will be off | 7.37 | In progress |
| Autoscaling of compute pools activated | Activates compute pool autoscaling by default. After you create a compute pool, Snowflake launches the minimum number of nodes and automatically creates additional nodes up to the maximum allowed. This is called autoscaling. New nodes are allocated when the running nodes do not have capacity to take any additional workload. | 7.36 | [Yes](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/working-with-compute-pool#autoscaling-of-compute-pool-nodes) |
| Service auto-resume  | Enables automatic resume of a service when there is ingress to the service or invocation of a service function exposed by the service.                                                                                                                                                                                                                                            | 7.34 | [Yes](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/reference/service#create-service) |
| Defer Ingress URL display for 120s after Service creation                           | Enables behavior in which there is a 120 second delay after a service is created before ingress URL is provisioned.<br><br>After a service is created, running `SHOW SERVICES` will display “Endpoints provisioning in progress... check back in a few minutes” for the public endpoint URL to allow time for dns provisioning and prevent users from entering the url in browser when the dns entry isn't present.<br><br>If you have automation on service endpoint fetching, please update your scripts to wait for the provisioning.                                                                                                                                                                                                                                                                         | 7.32    | In progress                                                                                                            |
| Tag support                                                                         | `CREATE SERVICE` supports an option to associate tags with the service. See documentation for Snowflake tags [here](https://docs.snowflake.com/en/sql-reference/sql/create-tag).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 7.32    | [Yes](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/reference/service#syntax)                                                                                                            |
| Service creation from inline spec syntax change                                     | Enables SQL syntax change that allows creation of services and jobs from an inline specification. The new syntax is as follows:<br><br>Creating a service from an inline spec:<br>```CREATE SERVICE [ IF NOT EXISTS ] <name> IN COMPUTE POOL <compute_pool_name> FROM SPECIFICATION $$ ... $$;```<br><br>Creating a job from an inline spec:<br>```EXECUTE SERVICE IN COMPUTE POOL <compute_pool_name> FROM SPECIFICATION $$ … $$ [ USING ([ ARG1 = <arg1>, ARG2 = <arg2>, ... ])]```                                                                                                                                                                                                                                                                                                                             | 7.31    | [Yes](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/reference/service#syntax)                                                                                                            |
| Disruptive Cluster Upgrade                                                          | Enables automatic disruptive cluster upgrades on all accounts.<br><br>As part of cluster upgrades, Snowflake will automatically deploy new OS, software, drivers and fix security vulnerabilities to compute pool nodes.<br>Customers should expect some downtime every 14 to 21 days after cluster creation/re-creation date during the maintenance period. The maintenance period runs every Tuesday, Wednesday, Thursday and Friday from 12 am to 5 am.<br><br>As part of the upgrades, all instances in the compute pools belonging to an account will be recreated. All services running in those compute pools will be recreated on the new instances. All jobs will be disrupted and customers will have to restart them once the Compute pool is ready. The expected downtime is approximately 30 minutes. | 7.30    | [Yes](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/working-with-compute-pool#compute-pool-maintenance)                                                                                                            |
| Add startTime field to get_job_status and get_service_status for running containers | Add `startTime` field with service / job start timestamp to the response of `GET_JOB_STATUS()` and `GET_SERVICE_STATUS()`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 7.29    | [Yes](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/reference/service#system-get-service-status)        |
| Privilege limits on show / decribe service(s)                                       | Enforce privilege limits on the `SHOW SERVICES` and `DESCRIBE SERVICE` commands.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 7.29    | [Yes](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/reference/service#show-services)                    |
| Dynamic validation of GPU requests                                                  | Enables multi-GPU scenarios and dynamic validation of service GPU requests based on the number of GPUs available in the selected compute pool instance type. The previous service creation flow did not allow a service to request more than 1 GPU regardless of the number available in the compute pool, except by enabling it customer by customer basis.                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 7.28    | [Yes](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/specification-reference#containers-resources-field)                                                                                                            |
| Deprecate ALTER COMPUTE POOL … STOP ALL SERVICES                                    | Deprecates syntax giving users the ability to stop all services within a given compute pool.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 7.27    | [Yes](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/working-with-compute-pool#managing-a-compute-pool)  |
| Compute pool suspension suspends its services                                       | Enables behavior in which suspending a compute pool suspends all of the services running inside of it.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 7.27    | [Yes](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/working-with-compute-pool#managing-a-compute-pool)  |
| GET_JOB_STATUS can wait for job terminal state                                      | Allows users to provide a `<timeout_secs>` param to `GET_JOB_STATUS()` which denotes the number of seconds to wait for the job to reach a terminal state (DONE or FAILED) before returning the status.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 7.25    | [Yes](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/reference/execute-service#system-get-job-status)    |
| CPU requests and limits                                                             | Gives users the ability to set CPU resource requests and limits for individual containers in the `containers.resources` field in the service or job spec.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 7.23    | [Yes](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/specification-reference#containers-resources-field) |
| Shared memory volumes                                                               | Introduces shared memory volumes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 7.22    | [Yes](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/specification-reference)                          |
| Compute pool auto-suspend feature                                                   | Gives users the ability to set `AUTO_SUSPEND_SECS` parameter during compute pool creation to specify the number of seconds of inactivity after which the compute pool is automatically suspended. The auto-suspend duration can be modified for an existing compute pool with the following synax: `ALTER COMPUTE POOL <name> SET AUTO_SUSPEND_SECS = <num>`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 7.22    | [Yes](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/reference/compute-pool#create-compute-pool)         |
| Custom secrets                                                                      | Enables use of `containers.secrets` to pass Snowflake secrets objects to containers.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 7.22    | [Yes](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/specification-reference#containers-secrets-field)   |
| Add ACCOUNT_USAGE view                                                              | Creates ACCOUNT_USAGE views in user accounts to provide information on credit consumption by snowpark container services compute pools.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 7.22    | [Yes](https://docs.snowflake.com/LIMITEDACCESS/snowpark-containers/accounts-orgs-usage-views)                          |
